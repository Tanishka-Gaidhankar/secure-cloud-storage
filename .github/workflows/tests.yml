name: Tests and Code Quality
on:
  push:
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main

jobs:
  lint-and-test:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3
      
      - name: Check HTML Syntax
        run: |
          echo "Checking HTML file syntax..."
          if grep -q "<html" index.html && grep -q "</html>" index.html; then
            echo "✓ HTML structure looks good"
          else
            echo "✗ HTML structure issues found"
            exit 1
          fi
      
      - name: Validate CSS
        run: |
          echo "Checking CSS file..."
          if [ -f "styles.css" ]; then
            echo "✓ CSS file exists and is valid"
          else
            echo "✗ CSS file missing"
            exit 1
          fi
      
      - name: Validate JavaScript
        run: |
          echo "Checking JavaScript file..."
          if [ -f "script.js" ]; then
            echo "✓ JavaScript file exists and is valid"
          else
            echo "✗ JavaScript file missing"
            exit 1
          fi
      
      - name: Check Docker Configuration
        run: |
          echo "Validating Dockerfile..."
          if grep -q "FROM nginx:alpine" Dockerfile; then
            echo "✓ Dockerfile is valid"
          else
            echo "✗ Dockerfile issues found"
            exit 1
          fi
      
      - name: Check Docker Compose
        run: |
          echo "Validating docker-compose.yml..."
          if [ -f "docker-compose.yml" ]; then
            echo "✓ docker-compose.yml exists"
          else
            echo "✗ docker-compose.yml missing"
            exit 1
          fi
      
      - name: Build Docker Image Test
        run: |
          echo "Testing Docker build..."
          docker build -t secure-cloud-storage:test .
          echo "✓ Docker image builds successfully"
      
      - name: Test Quality Summary
        run: |
          echo "══════════════════════════════════════"
          echo "   Quality Check Passed Successfully!"
          echo "══════════════════════════════════════"
          echo "✓ HTML validation passed"
          echo "✓ CSS validation passed"
          echo "✓ JavaScript validation passed"
          echo "✓ Dockerfile validation passed"
          echo "✓ Docker image builds successfully"
          echo "Ready for deployment!"
